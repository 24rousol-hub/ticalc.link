!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){const{ticalc:r,tifiles:o}=n(1);let i=null,c=null;function s(){document.querySelectorAll(".buttons button").forEach(e=>e.classList.remove("active","complete")),i?document.querySelector("#connect").classList.add("complete"):(document.querySelector("#connect").classList.add("active"),document.querySelector("#connect").focus()),c?document.querySelector("#upload").classList.add("complete"):i&&(document.querySelector("#upload").classList.add("active"),document.querySelector("#upload").focus()),i&&c&&(document.querySelector("#start").classList.add("active"),document.querySelector("#start").focus())}function a(e){e&&"Calculator model not supported"==e.message?confirm("Sorry, it looks like your device is not yet supported. Would you like to submit it for consideration?")&&function(e){document.querySelector("#flow").innerHTML=`\n    <h1>Device info to submit</h1>\n    <p>Please <a href='https://github.com/Timendus/ticalc-usb/issues/new?assignees=&labels=device+support+request&template=calculator-support-request.md&title=Calculator+support+request' target="_blank">file a support request on Github</a> with the following information:</p>\n    <pre>${JSON.stringify({deviceClass:e.deviceClass,deviceProtocol:e.deviceProtocol,deviceSubclass:e.deviceSubclass,deviceVersionMajor:e.deviceVersionMajor,deviceVersionMinor:e.deviceVersionMinor,deviceVersionSubminor:e.deviceVersionSubminor,manufacturerName:e.manufacturerName,productId:e.productId,productName:e.productName,serialNumber:e.serialNumber,usbVersionMajor:e.usbVersionMajor,usbVersionMinor:e.usbVersionMinor,usbVersionSubminor:e.usbVersionSubminor,vendorId:e.vendorId},null,2)}</pre>\n  `}(e.device):console.error(e)}window.addEventListener("load",()=>{r.browserSupported()?(!function(){const e=r.models().filter(e=>"supported"==e.status||"beta"==e.status).map(e=>"beta"==e.status?e.name+" (beta)":e.name).join(", ");document.querySelector("#supported").innerText=e}(),r.addEventListener("disconnect",e=>{e==i&&(i=null,s())}),r.addEventListener("connect",async e=>{("experimental"!=e.status&&"beta"!=e.status||confirm(`It looks like your device (${e.name}) only has ${e.status} support. Are you sure you want to continue?`))&&await e.isReady()&&(i=e,s())}),s(),document.querySelector("#connect").addEventListener("click",()=>r.choose().catch(e=>a(e))),document.querySelector("#upload").addEventListener("click",()=>function(){const e=document.createElement("input");e.type="file",e.accept=".8xp,.8xg,.83p,.83g,.82p,.82g",e.addEventListener("change",async e=>{c=o.parseFile(await function(e){return new Promise((t,n)=>{var r=new FileReader;r.addEventListener("load",e=>t(new Uint8Array(e.target.result))),r.readAsArrayBuffer(e)})}(e.target.files[0])),console.log(c),o.isValid(c)||(c=null,alert("The file you have selected does not seem to be a valid calculator file")),s()}),e.click()}()),document.querySelector("#start").addEventListener("click",()=>async function(){if(i&&c){if(!i.canReceive(c))return alert("The file you have selected does not appear to be a valid file for your "+i.name);if((await i.getFreeMem()).ram<c.size)return alert("Your calculator does not have enough free memory to receive this file");try{await i.sendFile(c),document.querySelector("#start").classList.remove("active"),document.querySelector("#start").classList.add("complete"),setTimeout(()=>alert("The file has been sent!"),100)}catch(e){alert("Sorry, something went wrong 😢"),console.error(e)}}}()),r.init({supportLevel:"none"}).catch(e=>a(e)),document.querySelector("#flow").classList.add("active"),document.querySelector("#incompatible").classList.remove("active")):(document.querySelector("#flow").classList.remove("active"),document.querySelector("#incompatible").classList.add("active"))})},function(e,t,n){e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){const r=n(8),o=n(2),i=n(1);e.exports=class{constructor({device:e,properties:t}){this._d=new r(e),Object.assign(this,t)}async connect(){return await this._d.connect(),this}canReceive(e){return this.compatibleFiles.includes(e.calcType)}async isReady(){try{return await this._d.send({type:o.virtualPacketTypes.DUSB_VPKT_PING,data:o.modes.DUSB_MODE_NORMAL}),await this._d.expect(o.virtualPacketTypes.DUSB_VPKT_MODE_SET),!0}catch(e){return console.debug(e),!1}}async pressKey(e){await this._d.send({type:o.virtualPacketTypes.DUSB_VPKT_EXECUTE,data:[0,0,o.executeCommands.DUSB_EID_KEY,0,e]}),await this._d.expect(o.virtualPacketTypes.DUSB_VPKT_DELAY_ACK),await this._d.expect(o.virtualPacketTypes.DUSB_VPKT_DATA_ACK)}async getFreeMem(){await this._d.send({type:o.virtualPacketTypes.DUSB_VPKT_PARM_REQ,data:[0,2,i.intToBytes(o.parameters.DUSB_PID_FREE_RAM,2),i.intToBytes(o.parameters.DUSB_PID_FREE_FLASH,2)].flat()});const e=await this._d.expect(o.virtualPacketTypes.DUSB_VPKT_DELAY_ACK),t=i.bytesToInt(e.data);await this._d.wait(t/1e3);const n=await this._d.expect(o.virtualPacketTypes.DUSB_VPKT_PARM_DATA),r=i.destructParameters(n.data);if(!r.every(e=>e.ok))throw"Could not succesfully get all parameters";return{ram:r.find(e=>e.type==o.parameters.DUSB_PID_FREE_RAM).value,flash:r.find(e=>e.type==o.parameters.DUSB_PID_FREE_FLASH).value}}async sendFile(e){for(let t=0;t<e.entries.length;t++)await this._sendEntry(e.entries[t])}async _sendEntry(e){await this._d.send({type:o.virtualPacketTypes.DUSB_VPKT_RTS,data:[...i.intToBytes(e.name.length,2),...i.asciiToBytes(e.name,e.name.length),0,...i.intToBytes(e.size,4),o.transferModes.SILENT,...this._entryParameters(e)]}),await this._d.expect(o.virtualPacketTypes.DUSB_VPKT_DATA_ACK),await this._d.send({type:o.virtualPacketTypes.DUSB_VPKT_VAR_CNTS,data:e.data}),await this._d.expect(o.virtualPacketTypes.DUSB_VPKT_DATA_ACK),await this._d.send({type:o.virtualPacketTypes.DUSB_VPKT_EOT})}_entryParameters(e){return i.constructParameters([{type:o.attributes.DUSB_AID_VAR_TYPE,size:4,value:4026990592+e.type},{type:o.attributes.DUSB_AID_ARCHIVED,size:1,value:e.attributes&&e.attributes.archived?1:0},{type:o.attributes.DUSB_AID_VAR_VERSION,size:4,value:e.attributes&&e.attributes.version||0}])}}},function(e,t,n){function r(e,t){const n=e.data&&e.data.length||0,r=o(n,4);r.splice(4,0,...o(e.type,t));const i=new Uint8Array(r.length+n);return i.set(r),i.set(e.data||[],r.length),i}function o(e,t){if(e>Number.MAX_SAFE_INTEGER)throw"Number too big to reliably convert";const n=[];for(;t>0;)t--,n.push(e/Math.pow(256,t)&255);return n}function i(e){if(!function(e){let t=!1;return(e=e.filter(e=>!(0==e&&!t||(t=!0,0)))).length<7||7==e.length&&e[0]<=31}(e))throw"Number too big to reliably convert";let t=e.length,n=0,r=0;for(;t>0;)t--,n+=(255&e[r++])*Math.pow(256,t);return n}e.exports={constructRawPacket:function(e){return r(e,1)},destructRawPacket:function(e){return{size:i(e.slice(0,4)),type:e[4],data:e.slice(5)}},constructVirtualPacket:function(e){return r(e,2)},destructVirtualPacket:function(e){return{size:i(e.slice(0,4)),type:i(e.slice(4,6)),data:e.slice(6)}},constructParameters:function(e){return new Uint8Array([o(e.length,2),...e.map(e=>[o(e.type,2),o(e.size,2),o(e.value,e.size)].flat())].flat())},destructParameters:function(e){const t=[],n=i(e.slice(0,2));let r=2;for(let o=0;o<n;o++){const n=i(e.slice(r+3,r+5));t.push({type:i(e.slice(r,r+2)),ok:0==e[r+2],size:n,value:i(e.slice(r+5,r+5+n))}),r+=5+n}return t},intToBytes:o,bytesToInt:i,asciiToBytes:function(e,t){t=t||e.length+1;const r=new("undefined"!=typeof TextEncoder?TextEncoder:n(3).TextEncoder)("utf-8").encode(e),o=new Uint8Array(t);return o.set(r.slice(0,t)),o},bytesToAscii:function(e){const t=e.indexOf(0);return t>=0&&(e=e.slice(0,t)),new("undefined"!=typeof TextDecoder?TextDecoder:n(3).TextDecoder)("utf-8").decode(e)},chunkArray:function(e,t){const n=[];let r,o=0;for(r=0;r<t.length;r++)if(n.push(e.slice(o,o+t[r])),o+=t[r],o>=e.length)return n;for(r--;o<e.length;)n.push(e.slice(o,o+t[r])),o+=t[r];return n}}},function(e,t){e.exports={rawPacketTypes:{DUSB_RPKT_BUF_SIZE_REQ:1,DUSB_RPKT_BUF_SIZE_ALLOC:2,DUSB_RPKT_VIRT_DATA:3,DUSB_RPKT_VIRT_DATA_LAST:4,DUSB_RPKT_VIRT_DATA_ACK:5},virtualPacketTypes:{DUSB_VPKT_PING:1,DUSB_VPKT_OS_BEGIN:2,DUSB_VPKT_OS_ACK:3,DUSB_VPKT_OS_HEADER:4,DUSB_VPKT_OS_DATA:5,DUSB_VPKT_EOT_ACK:6,DUSB_VPKT_PARM_REQ:7,DUSB_VPKT_PARM_DATA:8,DUSB_VPKT_DIR_REQ:9,DUSB_VPKT_VAR_HDR:10,DUSB_VPKT_RTS:11,DUSB_VPKT_VAR_REQ:12,DUSB_VPKT_VAR_CNTS:13,DUSB_VPKT_PARM_SET:14,DUSB_VPKT_MODIF_VAR:16,DUSB_VPKT_EXECUTE:17,DUSB_VPKT_MODE_SET:18,DUSB_VPKT_DATA_ACK:43520,DUSB_VPKT_DELAY_ACK:47872,DUSB_VPKT_EOT:56576,DUSB_VPKT_ERROR:60928,HEADER_SIZE:6},modes:{DUSB_MODE_STARTUP:[0,1,0,1,0,0,0,0,7,208],DUSB_MODE_BASIC:[0,2,0,1,0,0,0,0,7,208],DUSB_MODE_NORMAL:[0,3,0,1,0,0,0,0,7,208]},executeCommands:{DUSB_EID_PRGM:0,DUSB_EID_ASM:1,DUSB_EID_APP:2,DUSB_EID_KEY:3,DUSB_EID_UNKNOWN:4},parameters:{DUSB_PID_PRODUCT_NUMBER:1,DUSB_PID_PRODUCT_NAME:2,DUSB_PID_MAIN_PART_ID:3,DUSB_PID_HW_VERSION:4,DUSB_PID_FREE_RAM:14,DUSB_PID_FREE_FLASH:17,DUSB_PID_COLOR_AVAILABLE:27,DUSB_PID_BITS_PER_PIXEL:29,DUSB_PID_LCD_WIDTH:30,DUSB_PID_LCD_HEIGHT:31,DUSB_PID_MATH_CAPABILITIES:75,DUSB_PID_PYTHON_ON_BOARD:93},attributes:{DUSB_AID_VAR_TYPE:2,DUSB_AID_ARCHIVED:3,DUSB_AID_VAR_VERSION:8},transferModes:{SILENT:1,NON_SILENT:2}}},function(e,t,n){(function(e){var r=Object.getOwnPropertyDescriptors||function(e){for(var t=Object.keys(e),n={},r=0;r<t.length;r++)n[t[r]]=Object.getOwnPropertyDescriptor(e,t[r]);return n},o=/%[sdj%]/g;t.format=function(e){if(!h(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(s(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,c=String(e).replace(o,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}})),a=r[n];n<i;a=r[++n])_(a)||!b(a)?c+=" "+a:c+=" "+s(a);return c},t.deprecate=function(n,r){if(void 0!==e&&!0===e.noDeprecation)return n;if(void 0===e)return function(){return t.deprecate(n,r).apply(this,arguments)};var o=!1;return function(){if(!o){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),o=!0}return n.apply(this,arguments)}};var i,c={};function s(e,n){var r={seen:[],stylize:u};return arguments.length>=3&&(r.depth=arguments[2]),arguments.length>=4&&(r.colors=arguments[3]),y(n)?r.showHidden=n:n&&t._extend(r,n),T(r.showHidden)&&(r.showHidden=!1),T(r.depth)&&(r.depth=2),T(r.colors)&&(r.colors=!1),T(r.customInspect)&&(r.customInspect=!0),r.colors&&(r.stylize=a),l(r,e,r.depth)}function a(e,t){var n=s.styles[t];return n?"["+s.colors[n][0]+"m"+e+"["+s.colors[n][1]+"m":e}function u(e,t){return e}function l(e,n,r){if(e.customInspect&&n&&I(n.inspect)&&n.inspect!==t.inspect&&(!n.constructor||n.constructor.prototype!==n)){var o=n.inspect(r,e);return h(o)||(o=l(e,o,r)),o}var i=function(e,t){if(T(t))return e.stylize("undefined","undefined");if(h(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return m(t)?e.stylize(""+t,"number"):y(t)?e.stylize(""+t,"boolean"):_(t)?e.stylize("null","null"):void 0}(e,n);if(i)return i;var c=Object.keys(n),s=function(e){var t={};return e.forEach((function(e,n){t[e]=!0})),t}(c);if(e.showHidden&&(c=Object.getOwnPropertyNames(n)),S(n)&&(c.indexOf("message")>=0||c.indexOf("description")>=0))return p(n);if(0===c.length){if(I(n)){var a=n.name?": "+n.name:"";return e.stylize("[Function"+a+"]","special")}if(v(n))return e.stylize(RegExp.prototype.toString.call(n),"regexp");if(g(n))return e.stylize(Date.prototype.toString.call(n),"date");if(S(n))return p(n)}var u,b="",P=!1,D=["{","}"];return f(n)&&(P=!0,D=["[","]"]),I(n)&&(b=" [Function"+(n.name?": "+n.name:"")+"]"),v(n)&&(b=" "+RegExp.prototype.toString.call(n)),g(n)&&(b=" "+Date.prototype.toUTCString.call(n)),S(n)&&(b=" "+p(n)),0!==c.length||P&&0!=n.length?r<0?v(n)?e.stylize(RegExp.prototype.toString.call(n),"regexp"):e.stylize("[Object]","special"):(e.seen.push(n),u=P?function(e,t,n,r,o){for(var i=[],c=0,s=t.length;c<s;++c)A(t,String(c))?i.push(d(e,t,n,r,String(c),!0)):i.push("");return o.forEach((function(o){o.match(/^\d+$/)||i.push(d(e,t,n,r,o,!0))})),i}(e,n,r,s,c):c.map((function(t){return d(e,n,r,s,t,P)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(u,b,D)):D[0]+b+D[1]}function p(e){return"["+Error.prototype.toString.call(e)+"]"}function d(e,t,n,r,o,i){var c,s,a;if((a=Object.getOwnPropertyDescriptor(t,o)||{value:t[o]}).get?s=a.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):a.set&&(s=e.stylize("[Setter]","special")),A(r,o)||(c="["+o+"]"),s||(e.seen.indexOf(a.value)<0?(s=_(n)?l(e,a.value,null):l(e,a.value,n-1)).indexOf("\n")>-1&&(s=i?s.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+s.split("\n").map((function(e){return"   "+e})).join("\n")):s=e.stylize("[Circular]","special")),T(c)){if(i&&o.match(/^\d+$/))return s;(c=JSON.stringify(""+o)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(c=c.substr(1,c.length-2),c=e.stylize(c,"name")):(c=c.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),c=e.stylize(c,"string"))}return c+": "+s}function f(e){return Array.isArray(e)}function y(e){return"boolean"==typeof e}function _(e){return null===e}function m(e){return"number"==typeof e}function h(e){return"string"==typeof e}function T(e){return void 0===e}function v(e){return b(e)&&"[object RegExp]"===P(e)}function b(e){return"object"==typeof e&&null!==e}function g(e){return b(e)&&"[object Date]"===P(e)}function S(e){return b(e)&&("[object Error]"===P(e)||e instanceof Error)}function I(e){return"function"==typeof e}function P(e){return Object.prototype.toString.call(e)}function D(e){return e<10?"0"+e.toString(10):e.toString(10)}t.debuglog=function(n){if(T(i)&&(i=e.env.NODE_DEBUG||""),n=n.toUpperCase(),!c[n])if(new RegExp("\\b"+n+"\\b","i").test(i)){var r=e.pid;c[n]=function(){var e=t.format.apply(t,arguments);console.error("%s %d: %s",n,r,e)}}else c[n]=function(){};return c[n]},t.inspect=s,s.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},s.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},t.isArray=f,t.isBoolean=y,t.isNull=_,t.isNullOrUndefined=function(e){return null==e},t.isNumber=m,t.isString=h,t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=T,t.isRegExp=v,t.isObject=b,t.isDate=g,t.isError=S,t.isFunction=I,t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=n(10);var w=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function E(){var e=new Date,t=[D(e.getHours()),D(e.getMinutes()),D(e.getSeconds())].join(":");return[e.getDate(),w[e.getMonth()],t].join(" ")}function A(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.log=function(){console.log("%s - %s",E(),t.format.apply(t,arguments))},t.inherits=n(11),t._extend=function(e,t){if(!t||!b(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e};var B="undefined"!=typeof Symbol?Symbol("util.promisify.custom"):void 0;function O(e,t){if(!e){var n=new Error("Promise was rejected with a falsy value");n.reason=e,e=n}return t(e)}t.promisify=function(e){if("function"!=typeof e)throw new TypeError('The "original" argument must be of type Function');if(B&&e[B]){var t;if("function"!=typeof(t=e[B]))throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),t}function t(){for(var t,n,r=new Promise((function(e,r){t=e,n=r})),o=[],i=0;i<arguments.length;i++)o.push(arguments[i]);o.push((function(e,r){e?n(e):t(r)}));try{e.apply(this,o)}catch(e){n(e)}return r}return Object.setPrototypeOf(t,Object.getPrototypeOf(e)),B&&Object.defineProperty(t,B,{value:t,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(t,r(e))},t.promisify.custom=B,t.callbackify=function(t){if("function"!=typeof t)throw new TypeError('The "original" argument must be of type Function');function n(){for(var n=[],r=0;r<arguments.length;r++)n.push(arguments[r]);var o=n.pop();if("function"!=typeof o)throw new TypeError("The last argument must be of type Function");var i=this,c=function(){return o.apply(i,arguments)};t.apply(this,n).then((function(t){e.nextTick(c,null,t)}),(function(t){e.nextTick(O,t,c)}))}return Object.setPrototypeOf(n,Object.getPrototypeOf(t)),Object.defineProperties(n,r(t)),n}}).call(this,n(9))},function(e,t,n){e.exports={ticalc:n(5),tifiles:n(19)}},function(e,t,n){const r=n(6),o=[n(7),n(12),n(13),n(14),n(15),n(16),n(17)],i=["none","experimental","beta","partial-support","supported"];let c,s=l();const a={},u={connect:[],disconnect:[]};function l(e){if(e||(e="supported"),!i.includes(e))throw"Invalid support level selected, should be one of: "+i.join(", ");if("none"==e)return o.concat(n(18));const t=i.slice(i.indexOf(e));return o.filter(e=>t.includes(e.status))}function p(){return!!navigator.usb}async function d(e){const t=s.filter(e=>e.matcher).find(t=>Object.keys(t.matcher).every(n=>t.matcher[n]==e[n]));if(!t)throw{message:"Calculator model not supported",device:e};const n=await t.connect(e);return a[e.toString()]=n,n}async function f(e){return a[e]||await d(e)}function y(){if(!p())throw"Browser not supported";return c||(c=r(navigator.usb,{injections:{transferIn:(e,t)=>console.debug("🖥←📱 Received:",_(new Uint8Array(t.data.buffer))),transferOut:(e,t)=>console.debug("🖥→📱 Sent:    ",_(e[1]))}}),c)}function _(e){const t=[...e].map(e=>e.toString(16).toUpperCase().padStart(2,"0"));return[t.slice(0,4).join(""),t.slice(4,5).join(""),t.length>10?[t.slice(5,9).join(""),t.slice(9,11).join(""),t.slice(11).join(",")]:t.slice(5).join(",")].flat().join(" ")}e.exports={browserSupported:p,models:()=>o.map(e=>({name:e.name,status:e.status,matcher:e.matcher})),addEventListener:(e,t)=>{if(!Object.keys(u).includes(e))throw"Invalid event name: "+e;u[e].push(t)},init:async(e={})=>{e.usb||y(),s=l(e.supportLevel),navigator.usb.addEventListener("connect",async e=>{const t=await f(device);console.debug("📱 Calculator connected"),t&&u.connect.forEach(e=>e(t))}),navigator.usb.addEventListener("disconnect",e=>{const t=a[e.device];console.debug("📱 Calculator disconnected"),t&&u.disconnect.forEach(e=>e(t))});const t=await navigator.usb.getDevices();for(let e=0;e<t.length;e++){const n=await f(t[e]);u.connect.forEach(e=>e(n))}},choose:async(e={})=>{const t=e.usb||y();let n;try{n=await t.requestDevice({filters:s.map(e=>e.identifier).filter((e,t,n)=>t===n.findIndex(t=>t.vendorId===e.vendorId&&t.productId===e.productId)).sort((e,t)=>e.vendorId>t.vendorId?1:e.vendorId<t.vendorId?-1:e.productId<t.productId?1:-1)})}catch(e){throw e}const r=await d(n);u.connect.forEach(e=>e(r))},getRecording:()=>c}},function(e,t){e.exports=(e,t)=>new n(e,t);class n{constructor(e,t={}){this._usb=e,this._options=t,this._steps=[]}async requestDevice(...e){const t=await this._usb.requestDevice(...e),n=this._proxy(t);return this._logStep({action:"asyncFunctionCall",name:"requestDevice",parameters:e,resolve:t}),n}async getDevices(...e){const t=await this._usb.getDevices(...e),n=t.map(e=>this._proxy(e));return this._logStep({action:"asyncFunctionCall",name:"getDevices",parameters:e,resolve:t}),n}getSteps(){return this._steps}_proxy(e){return new Proxy(e,{get:(e,t)=>{if("function"!=typeof e[t]){const n=Reflect.get(e,t);return this._logPropertyAccess(n,t)}return(...n)=>{const r=e[t](...n);return r instanceof Promise?this._logPromise(r,t,n):this._logFunctionCall(r,t,n)}}})}_logPromise(e,t,n){return e.then(e=>(this._logStep({action:"asyncFunctionCall",name:t.toString(),parameters:r(n),resolve:r(e)}),this._inject(e,t,n),e)).catch(e=>{throw this._logStep({action:"asyncFunctionCall",name:t.toString(),parameters:r(n),reject:r(e)}),this._inject(e,t,n),e})}_logFunctionCall(e,t,n){return this._logStep({action:"functionCall",name:t.toString(),parameters:r(n),result:r(e)}),this._inject(e,t,n),e}_logPropertyAccess(e,t){return this._logStep({action:"propertyAccess",name:t.toString(),result:r(e)}),e}_logStep(e){this._steps.push(e),this._options.verbose&&console.debug(e)}_inject(e,t,n){this._options.injections&&this._options.injections[t]&&this._options.injections[t](n,e)}}function r(e){return e?e instanceof DataView?{byteLength:(t=e).byteLength,byteOffset:t.byteOffset,buffer:Array.from(new Uint8Array(t.buffer))}:Array.isArray(e)?e.map(e=>r(e)):"object"==typeof e?(n=e,Object.keys(n).reduce((e,t)=>(e[t]=r(n[t]),e),{})):JSON.parse(JSON.stringify(e)):e;var t,n}},function(e,t,n){const r={name:"TI-82 Advanced",status:"experimental",identifier:{vendorId:1105,productId:57352},matcher:{vendorId:1105,productId:57352,productName:"TI-82 Advanced"},compatibleFiles:["TI-83","TI-84 Plus"]},o=n(0);e.exports={...r,connect:e=>new o({device:e,properties:r}).connect()}},function(e,t,n){const r=n(2),o=n(1);e.exports=class{constructor(e){this._device=e}async connect(){await this._device.open(),await this._device.selectConfiguration(this._device.configuration.configurationValue);const e=this._device.configuration.interfaces[0];await this._device.claimInterface(e.interfaceNumber),this._inEndpoint=e.alternates[0].endpoints.find(e=>"in"==e.direction),this._outEndpoint=e.alternates[0].endpoints.find(e=>"out"==e.direction),this._bufferSize=await this._requestBufferSize()}async send(e){const t=o.chunkArray(e.data||[],[this._bufferSize-r.virtualPacketTypes.HEADER_SIZE,this._bufferSize]);for(let n=0;n<t.length;n++){const i=0==n?o.constructVirtualPacket({...e,data:t[n]}):t[n],c=n==t.length-1?r.rawPacketTypes.DUSB_RPKT_VIRT_DATA_LAST:r.rawPacketTypes.DUSB_RPKT_VIRT_DATA;await this._send(o.constructRawPacket({type:c,data:i})),await this._expectAck()}}async expect(e){const t=o.destructRawPacket(await this._receive());if(t.type!=r.rawPacketTypes.DUSB_RPKT_VIRT_DATA_LAST)throw`Expected raw packet type VIRT_DATA_LAST, but got ${t.type} instead`;const n=o.destructVirtualPacket(t.data);if(n.type!=e)throw`Expected virtual packet type ${e}, but got ${n.type} instead`;return await this._sendAck(),n}wait(e){return new Promise((t,n)=>{setTimeout(()=>t(),e)})}async _requestBufferSize(){await this._send(o.constructRawPacket({type:r.rawPacketTypes.DUSB_RPKT_BUF_SIZE_REQ,data:[0,0,4,0]}));const e=o.destructRawPacket(await this._receive());if(e.type!=r.rawPacketTypes.DUSB_RPKT_BUF_SIZE_ALLOC)throw`Expected BUF_SIZE_ALLOC, got ${e.type} instead`;return o.bytesToInt(e.data)}_send(e){return this._device.transferOut(this._outEndpoint.endpointNumber,e)}async _receive(){const e=await this._device.transferIn(this._inEndpoint.endpointNumber,this._inEndpoint.packetSize);if("ok"!=e.status)throw"Error in receiving data from device: "+e.status;return new Uint8Array(e.data.buffer)}_sendAck(){return this._send(o.constructRawPacket({type:r.rawPacketTypes.DUSB_RPKT_VIRT_DATA_ACK,data:[224,0]}))}async _expectAck(){const e=o.destructRawPacket(await this._receive());if(e.type!=r.rawPacketTypes.DUSB_RPKT_VIRT_DATA_ACK)throw`Expected ACK, got ${e.type} instead`}}},function(e,t){var n,r,o=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function c(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===i||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:i}catch(e){n=i}try{r="function"==typeof clearTimeout?clearTimeout:c}catch(e){r=c}}();var a,u=[],l=!1,p=-1;function d(){l&&a&&(l=!1,a.length?u=a.concat(u):p=-1,u.length&&f())}function f(){if(!l){var e=s(d);l=!0;for(var t=u.length;t;){for(a=u,u=[];++p<t;)a&&a[p].run();p=-1,t=u.length}a=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===c||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function y(e,t){this.fun=e,this.array=t}function _(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new y(e,t)),1!==u.length||l||s(f)},y.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=_,o.addListener=_,o.once=_,o.off=_,o.removeListener=_,o.removeAllListeners=_,o.emit=_,o.prependListener=_,o.prependOnceListener=_,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},function(e,t){e.exports=function(e){return e&&"object"==typeof e&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){const r={name:"TI-84 Plus",status:"supported",identifier:{vendorId:1105,productId:57347},matcher:{vendorId:1105,productId:57347},compatibleFiles:["TI-83","TI-84 Plus"]},o=n(0);e.exports={...r,connect:e=>new o({device:e,properties:r}).connect()}},function(e,t,n){const r={name:"TI-84 Plus C Silver Edition",status:"experimental",identifier:{vendorId:1105,productId:57352},matcher:{vendorId:1105,productId:57352,productName:"TI-84 Plus C Silver Edition"},compatibleFiles:["TI-83","TI-84 Plus","TI-84 Plus Color"]},o=n(0);e.exports={...r,connect:e=>new o({device:e,properties:r}).connect()}},function(e,t,n){const r={name:"TI-84 Plus SE",status:"beta",identifier:{vendorId:1105,productId:57352},matcher:{vendorId:1105,productId:57352,productName:"TI-84 Plus Silver Edition"},compatibleFiles:["TI-83","TI-84 Plus"]},o=n(0);e.exports={...r,connect:e=>new o({device:e,properties:r}).connect()}},function(e,t,n){const r={name:"TI-84 Plus T",status:"experimental",identifier:{vendorId:1105,productId:57352},matcher:{vendorId:1105,productId:57352,productName:"TI-84 Plus T"},compatibleFiles:["TI-83","TI-84 Plus"]},o=n(0);e.exports={...r,connect:e=>new o({device:e,properties:r}).connect()}},function(e,t,n){const r={name:"TI-83 Premium CE",status:"experimental",identifier:{vendorId:1105,productId:57352},matcher:{vendorId:1105,productId:57352,productName:"TI-83 Premium CE"},compatibleFiles:["TI-83","TI-84 Plus","TI-84 Plus Color"]},o=n(0);e.exports={...r,connect:e=>new o({device:e,properties:r}).connect()}},function(e,t,n){const r={name:"TI-84 Plus CE",status:"experimental",identifier:{vendorId:1105,productId:57352},matcher:{vendorId:1105,productId:57352,productName:"TI-84 Plus CE"},compatibleFiles:["TI-83","TI-84 Plus","TI-84 Plus Color"]},o=n(0);e.exports={...r,connect:e=>new o({device:e,properties:r}).connect()}},function(e,t){e.exports={identifier:{vendorId:1105}}},function(e,t,n){const r=n(1);function o(e,t){const n=[];let r=0;for(;r<t.size;){const o=i(e.slice(r),t);n.push(o),r+=o.entrySize}return n}function i(e,t){const n=function(e,t){const n=r.bytesToInt(e.slice(0,2).reverse()),o=13==n,i=n>=12;if("TI-85"==t.calcType){const t=e[5];return{size:6+t+2,name:e.slice(6,6+t),attributes:!1}}if("TI-86"==t.calcType)return{size:6+(i?8:e[5])+2,name:e.slice(6,6+e[5]),attributes:!1};if(o){const t=r.bytesToInt(e.slice(12,14).reverse());return{size:17,name:e.slice(5,13),attributes:128==t?{archived:!0,version:0}:{archived:!!(32768&t),version:255&t}}}return{size:15,name:e.slice(5,13),attributes:!1}}(e,t),o=r.bytesToInt(e.slice(2,4).reverse());return{name:r.bytesToAscii(n.name),type:e[4],attributes:n.attributes,size:o,data:e.slice(n.size,n.size+o),entrySize:n.size+o,debug:{packetLength:r.bytesToInt(e.slice(0,2).reverse()),ti83p:13==r.bytesToInt(e.slice(0,2).reverse()),padded86:r.bytesToInt(e.slice(0,2).reverse())>12,nameLength:e[5],headerSize:n.size,size2:r.bytesToInt(e.slice(n.size-2,n.size).reverse())}}}function c(e){return 26==e[0]&&12==e[1]&&0==e[2]?"TI-85 style signature present":26==e[0]&&10==e[1]&&0==e[2]?"TI-73/82/83/86 style signature present":"NONE"}e.exports={parseFile:e=>{const t=(n=e.slice(0,8),{"**TI73**":"TI-73","**TI82**":"TI-82","**TI83**":"TI-83","**TI83F*":"TI-84 Plus","**TI85**":"TI-85","**TI86**":"TI-86","**TI89**":"TI-89","**TI92**":"TI-92","**TI92P*":"TI-92 Plus","**V200**":"TI-V200","**TICBL*":"TI-CBL2"}[r.bytesToAscii(n)]||"NONE");var n;const i=r.bytesToInt(e.slice(53,55).reverse());return{calcType:t,size:i,comments:r.bytesToAscii(e.slice(11,53)),entries:o(e.slice(55),{size:i,calcType:t}),debug:{signature:c(e.slice(8,11)),sizeCorrect:e.length==i+8+3+42+2+2,checksum:e.slice(e.length-2,e.length)}}},isValid:e=>"NONE"!=e.calcType&&e.size>0&&e.debug.sizeCorrect&&e.entries.length>0}}])}]);